## Differential expression analysis

```{r finding_deg, message = FALSE, warning = FALSE, echo = TRUE, error = TRUE}

if(run_deg) {

  plan("multicore", workers = n_threads)
  options(future.globals.maxSize = 2000*1024^2)

  all_markers <- FindAllMarkers(
    object = seurat_object, only.pos = FALSE, 
    test.use = "t",
    random.seed = 2203,
    logfc.threshold = 0.25, 
    return.thresh = 0.01)

  if(auto_save) {
    
    saveRDS(all_markers, file = paste0('data/deg/', project_name, '_deg_analysis_', timestamp, '.RDS'))
    
  }

}

```

```{r deg_table, message = FALSE, warning = FALSE, echo = TRUE}

datatable(all_markers, 
    class = 'cell-border stripe',
    rownames = FALSE,
    filter = 'top',
    width = '100%', 
    options = list(scrollX = TRUE))


```
